{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  .chat-wrapper {
    position: relative;
    height: 500px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    z-index: 0;
  }

  .chat-overlay,
  .form-container {
    position: relative;
    z-index: 2;
  }

  .chat-overlay {
    flex-grow: 1;
    overflow-y: auto;
    padding-right: 10px;
  }

  .chat-message {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 12px;
    margin-bottom: 10px;
    font-size: 15px;
    color: black;
  }

  .chat-message.user {
    background-color: #f4f6f9;
    align-self: flex-end;
    text-align: right;
  }

  .chat-message.bot {
    background-color: #ffffff;
    align-self: flex-start;
    text-align: left;
  }

  .text-muted {
    font-size: 0.75rem;
    opacity: 0.6;
    margin-bottom: 4px;
  }

  .form-container {
    margin-top: 1px;
    width: 850px; 
  }
</style>

<div class="chat-wrapper">
  <div id="messages" class="chat-overlay d-flex flex-column">
    {% for msg in messages %}
      {% if msg.sender == 'bot' %}
        <div class="chat-message bot">
          <div class="text-muted">{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</div>
          <div>{{ msg.message|safe }}</div>
        </div>
      {% else %}
        <div class="chat-message user">
          <div class="text-muted">{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</div>
          <div>{{ msg.message }}</div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
  <form method="POST" class="form-container">
    <div class="input-group">
      <input type="text" name="message" class="form-control" placeholder="Type your query..." required autocomplete="off">
      <button class="btn btn-success" type="submit" aria-label="Send">
        <i class="bi bi-send-fill"></i>
      </button>
    </div>
  </form>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const messagesDiv = document.getElementById("messages");
  if (messagesDiv) {
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }
});
</script>

{% endblock %}
